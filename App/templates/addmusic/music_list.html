<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/music.css' %}">
    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" />
    <title>Melodify</title>
</head>
<body>
    <!-- Navbar -->
    <div class="navbar" id="navbar">
      <nav>
          <ul>
              <li>MELODIFY</li>
              <li>
                  <a href="{% url 'index' %}" style="text-decoration: none;">
                      <button class="btn-66">Home</button>
                  </a>
              </li>
              {% if user.is_authenticated %}
              <li>
                  <a href="{% url 'generate_lyrics' %}" style="text-decoration: none;">
                      <button class="btn-66">Generate</button>
                  </a>
              </li>
              <li>
                  <a href="{% url 'favorites_page' %}" style="text-decoration: none;">
                      <button class="btn-66">Favorites</button>
                  </a>
              </li>
              {% endif %}
              <li>
                  <a href="{% url 'about_view' %}" style="text-decoration: none;">
                      <button class="btn-66">About</button>
                  </a>
              </li>
              <li>
                <a href="https://research-5xrfvuiha3dr7dxprizufh.streamlit.app/" style="text-decoration: none;">
                    <button class="btn-66">Research</button>
                </a>
            </li>
              <!-- {% if user.is_authenticated %}
                  <li>
                      <a href="{% url 'profile_view' %}" style="text-decoration: none;">
                          <button class="btn-66">Profile</button>
                      </a>
                  </li>
                  <li>
                      <a href="{% url 'logout' %}" style="text-decoration: none;">
                          <button class="btn-66">Logout</button>
                      </a>
                  </li>
              {% else %}
                  <li>
                      <a href="{% url 'login' %}" style="text-decoration: none;">
                          <button class="btn-66">Login</button>
                      </a>
                  </li>
              {% endif %}
          </ul> -->
      </nav>
  </div>
  

    <section class="main swiper mySwiper">
        <div class="wrapper swiper-wrapper">
          <div class="slide swiper-slide">
            <img src="{% static 'img/banner-1.jpg'%}" alt="" class="image" />
            <div class="image-data">
              <span class="text">Enjoy the finest coffee drinks.</span>
              <h2>
                Enjoy Our Exclusive <br />
                Coffee and Cocktails
              </h2>
              <a href="#" class="button">About Us</a>
            </div>
          </div>
          <div class="slide swiper-slide">
            <img src="{% static 'img/banner-2.jpg'%}"  alt="" class="image" />
            <div class="image-data">
              <span class="text">We really like what we do.</span>
              <h2>
                Coffee Beans with a <br />
                Perfect Aroma
              </h2>
              <a href="#" class="button">About Us</a>
            </div>
          </div>
          <div class="slide swiper-slide">
            <img src="{% static 'img/banner-3.jpg'%}"  alt="" class="image" />
            <div class="image-data">
              <span class="text">Making Our coffee with lover.</span>
              <h2>
                Alluring and Fragrant <br />
                Coffee Aroma
              </h2>
              <a href="#" class="button">About Us</a>
            </div>
          </div>
        </div>
        <div class="swiper-button-next nav-btn"></div>
        <div class="swiper-button-prev nav-btn"></div>
        <div class="swiper-pagination"></div>
      </section>
      <div class="music-head">
        <h1># Enjoy The Music<br><span>With Melodify</span></h1>
    </div>
    <div class="search-bar">
        <form method="GET" action="{% url 'music_list' %}">
            <!-- <input type="text" name="q" placeholder="Search by title, artist, or category"> -->
            <!-- <input placeholder="Search..." class="input-search" name="q" type="text" required> -->
            <!-- <button type="submit">Search</button> -->
            <!-- <button type="submit" class="btn-1">
                <span>Search</span>
              </button> -->
              <div class="search">
                <div class="search-box">
                  <div class="search-field">
                    <input placeholder="Search..." class="input" type="text" name="q" required>
                    <div class="search-box-icon">
                      <button type="submit" aria-label="search" class="btn-icon-content">
                        <i class="search-icon">
                          <svg xmlns="://www.w3.org/2000/svg" version="1.1" viewBox="0 0 512 512"><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z" fill="#fff"></path></svg>
                        </i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
        </form>
    </div>
    <section class="container-2">
        <div class="music-list">
            {% for music in music_files %}
                <div class="music-card">
                    <div class="cover-image">
                        {% if music.cover_image %}
                            <img src="{{ music.cover_image.url }}" alt="{{ music.title }} Cover">
                        {% else %}
                            <img src="{% static 'default-cover.jpg' %}" alt="Default Cover"> <!-- Fallback image -->
                        {% endif %}
                    </div>
                    <div class="info">
                        <h2 class="title" style="color: wheat;">{{ music.title }}</h2>
                        <p>Artist: {{ music.artist }}</p>
                        <p>Category: {{ music.category }}</p> <!-- Display the category -->
                        <div class="custom-audio-player">
                            <audio id="audio-player-{{ music.id }}" src="{{ music.music_file.url }}"></audio>
                            <button class="play-pause-button" data-audio-id="audio-player-{{ music.id }}">Play</button>
                            <input type="range" id="progress-bar" min="0" max="100" value="0" step="1">
                            <div class="time-display">
                                <span id="current-time">0:00</span>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <!-- Download button -->
                            <a href="{{ music.music_file.url }}" download class="btn-1">Download</a>
                            <!-- Add to Favorites button -->
                            <button class="btn-1">
                                <a href="{% url 'add_to_favorites' music.id %}" style="color: white; text-decoration: none;">Add to Favorites</a>
                            </button>
                        </div>
                    </div>
                </div>
            {% empty %}
                <p>No music files found.</p>
            {% endfor %}
        </div>
    </section>
    

    <!-- Music List Swiper Section -->
    <!-- <section class="container-1">
        <div class="swiper">
            <div class="swiper-wrapper">
              
              <div class="swiper-slide">
                <h3>Song Title 1 - Artist 1</h3>
                <audio controls>
                  <source src="path/to/sample-music-file1.mp3" type="audio/mpeg">
                  Your browser does not support the audio element.
                </audio>
              </div>
              <div class="swiper-slide">
                <h3>Song Title 2 - Artist 2</h3>
                <audio controls>
                  <source src="path/to/sample-music-file2.mp3" type="audio/mpeg">
                  Your browser does not support the audio element.
                </audio>
              </div>
              <div class="swiper-slide">
                <h3>Song Title 3 - Artist 3</h3>
                <audio controls>
                  <source src="path/to/sample-music-file3.mp3" type="audio/mpeg">
                  Your browser does not support the audio element.
                </audio>
              </div>
              
              {% for music in music_files %}
                <div class="swiper-slide">
                  <h3>{{ music.title }} - {{ music.artist }}</h3>
                  <audio controls>
                    <source src="{{ music.music_file.url }}" type="audio/mpeg">
                    Your browser does not support the audio element.
                  </audio>
                </div>
              {% endfor %}
            </div>

            
            <div class="swiper-pagination"></div>
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
        </div> -->
    </section>

    <!-- footer -->
    <section class="section-three">
        {% include 'footer.html' %}
    </section>

    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>

    <!-- Initialize Swiper -->
    <script>
        var swiper = new Swiper('.swiper', {
          slidesPerView: 1,  // Show one slide at a time
          spaceBetween: 30,  // Space between slides
          loop: true,        // Enable looping
          pagination: {
            el: '.swiper-pagination',
            clickable: true,  // Make pagination dots clickable
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
    </script>

<script>
    var swiper = new Swiper(".mySwiper", {
      slidesPerView: 1,
      loop: true,
      pagination: {
        el: ".swiper-pagination",
        clickable: true,
      },
      navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev",
      },
    });
  </script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var audioPlayer = document.getElementById('audio-player');
        var playPauseButton = document.getElementById('play-pause-button');
        var progressBar = document.getElementById('progress-bar');
        var currentTimeDisplay = document.getElementById('current-time');
        var totalDurationDisplay = document.getElementById('total-duration');

        // Play or pause audio when button is clicked
        playPauseButton.addEventListener('click', function() {
            if (audioPlayer.paused) {
                audioPlayer.play();
                playPauseButton.textContent = 'Pause';  // Change button text to "Pause"
            } else {
                audioPlayer.pause();
                playPauseButton.textContent = 'Play';   // Change button text to "Play"
            }
        });

        // Update the total duration of the audio when it's loaded
        audioPlayer.addEventListener('loadedmetadata', function() {
            var totalMinutes = Math.floor(audioPlayer.duration / 60);
            var totalSeconds = Math.floor(audioPlayer.duration % 60);
            totalDurationDisplay.textContent = totalMinutes + ':' + (totalSeconds < 10 ? '0' + totalSeconds : totalSeconds);
        });

        // Update progress bar and current time as the audio plays
        audioPlayer.addEventListener('timeupdate', function() {
            var currentMinutes = Math.floor(audioPlayer.currentTime / 60);
            var currentSeconds = Math.floor(audioPlayer.currentTime % 60);
            currentTimeDisplay.textContent = currentMinutes + ':' + (currentSeconds < 10 ? '0' + currentSeconds : currentSeconds);
            
            // Update the progress bar
            var progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
            progressBar.value = progress;
        });

        // Allow clicking on the progress bar to seek within the audio
        progressBar.addEventListener('input', function() {
            var seekTime = (progressBar.value / 100) * audioPlayer.duration;
            audioPlayer.currentTime = seekTime;
        });

        // When audio ends, reset the play button to "Play"
        audioPlayer.addEventListener('ended', function() {
            playPauseButton.textContent = 'Play';
            progressBar.value = 0; // Reset progress bar to the start
            currentTimeDisplay.textContent = '0:00';
        });
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
    // Handle play/pause button clicks
    const playPauseButtons = document.querySelectorAll('.play-pause-button');
    
    playPauseButtons.forEach(button => {
        button.addEventListener('click', function() {
            const audioId = this.dataset.audioId;
            const audioPlayer = document.getElementById(audioId);
            
            if (audioPlayer.paused) {
                audioPlayer.play();
                this.textContent = 'Pause';
            } else {
                audioPlayer.pause();
                this.textContent = 'Play';
            }
        });
    });

    // Handle add to favorites button clicks
    const favoriteButtons = document.querySelectorAll('.add-to-favorites');
    
    favoriteButtons.forEach(button => {
        button.addEventListener('click', function() {
            const musicId = this.dataset.musicId;
            // Simulate adding to favorites (you can implement this with your backend)
            alert(`Music ID ${musicId} added to favorites!`);
            // Here you would typically send an AJAX request to your backend to save this in the database
        });
    });
});

</script>

</body>
</html>
